[toc]

# Something in C…

> 在进入C++之前，首先复习一下C语言中一些容易出问题和忽视的知识点



#### 数组初始化

数组在定义时就进行初始化，最常用在把数组元素全部初始化为0的时候。

比如，以下代码会将数组a的所有元素都初始化为0：

```
int a[10] = {0};
```

拓展一下：

```
int a[10] = {1};
```

上述代码中，初始化后的数组a是不是所有元素均为1呢？答案是否定的。只有a[0]会被初始化为1，而a[1~9]会被默认初始化为0，这点需要注意。



#### Volatile关键字

在C语言中，volatile关键字用于告诉编译器该变量可能会在任何时候被意想不到地改变（比如多线程情况下），因此，编译器在生成代码时不应对此变量进行优化，使得在用到这个变量时必须每次都重新从内存中读取这个变量的值，而不是使用保存在寄存器里的备份。



#### Static关键字

```c
int sum_func(int a) {    
    static int b=1;    // 局部静态变量只会被初始化一次
    int c = 1;    
    b+=1;    
    return(a+b+c);
}

void main() {    
    int i;    
    int a=2;    
    for(i=0;i<5;i++) {        
        printf("%d,", sum_func(a));    
    }
}
```

执行上述代码输出：5、6、7、8、9



#### 宏定义和typedef

宏定义参数需要将参数用括号括起来！

> 宏定义和typedef的区别？

宏定义是将定义的表达式直接替换展开到调用宏的代码处，容易产生错误。

```c
#define dS struct s * 
typedef struct s * tS; 

dS p1,p2;
tS p3,p4;
```

第一个例子在宏定义展开替换后为`Struct s *p1, p2;`，定义p1为一个指向结构体s的指针，而p2为一个实际的结构体类型为s的结构。而第二个例子正确地定义了p3和p4两个指向结构体的指针。

所以一般在用于**为一个已经存在的类型创建一个新的名字**时，应尽量使用typedef，而不是#define。